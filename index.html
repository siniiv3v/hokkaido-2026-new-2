```html
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>北海道旅程 App</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- FontAwesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f3f4f6; -webkit-tap-highlight-color: transparent; }
        /* 隱藏 Scrollbar 但保留功能 */
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* 模擬 iOS 玻璃擬態 */
        .glass { background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); }
        
        /* 卡片過場動畫 */
        .fade-enter-active, .fade-leave-active { transition: opacity 0.3s ease; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }
    </style>
</head>
<body class="text-gray-800 h-screen flex flex-col overflow-hidden">

<div id="app" class="flex flex-col h-full relative">

    <!-- 1. 頂部導航列 (Tab Navigation) -->
    <header class="glass z-50 shadow-sm border-b border-gray-200 pt-safe-top">
        <div class="flex justify-around items-center h-16 px-2">
            <button v-for="tab in tabs" :key="tab.id" @click="currentTab = tab.id"
                class="flex flex-col items-center justify-center w-full h-full transition-colors duration-200"
                :class="currentTab === tab.id ? 'text-blue-600' : 'text-gray-400'">
                <i :class="tab.icon + ' text-xl mb-1'"></i>
                <span class="text-[10px] font-medium">{{ tab.name }}</span>
                <div v-if="currentTab === tab.id" class="absolute bottom-0 w-8 h-1 bg-blue-600 rounded-t-full"></div>
            </button>
        </div>
    </header>

    <!-- 2. 主內容區 -->
    <main class="flex-1 overflow-y-auto hide-scrollbar p-4 pb-24 bg-gray-50 relative">
        
        <!-- ===== 分頁 1: 行程表 (Itinerary) ===== -->
        <div v-if="currentTab === 'itinerary'">
            <!-- 日期選擇器 -->
            <div class="flex items-center space-x-3 overflow-x-auto hide-scrollbar mb-6 pb-2">
                <div v-for="(day, index) in itineraryData" :key="index" 
                     @click="currentDayIndex = index"
                     class="flex-shrink-0 flex flex-col items-center justify-center w-16 h-20 rounded-2xl border transition-all duration-200 shadow-sm snap-center"
                     :class="currentDayIndex === index ? 'bg-blue-600 text-white border-blue-600 transform scale-105' : 'bg-white text-gray-500 border-gray-200'">
                    <span class="text-xs font-light">Day {{ index + 1 }}</span>
                    <span class="text-xs uppercase font-medium">{{ getDayOfWeek(day.date) }}</span>
                    <span class="text-xl font-bold">{{ getDayDate(day.date) }}</span>
                </div>
                <!-- 新增日期按鈕 -->
                <button @click="addDay" class="flex-shrink-0 flex items-center justify-center w-12 h-20 rounded-2xl bg-gray-200 text-gray-500 shadow-inner">
                    <i class="fa-solid fa-plus text-xl"></i>
                </button>
            </div>

            <!-- 當日行程列表 -->
            <div class="space-y-0">
                <!-- 第一個行程的交通時間 (從住宿出發) -->
                <div v-if="currentDayEvents.length > 0" class="flex justify-center items-center py-2 text-gray-400 text-xs">
                    <div class="bg-gray-200 px-3 py-1 rounded-full flex items-center shadow-inner">
                        <i class="fa-solid fa-hotel mr-2"></i>
                        <span>從飯店出發: {{ calcTravelTime(null, currentDayEvents[0]) }}</span>
                    </div>
                </div>

                <div v-for="(event, index) in currentDayEvents" :key="event.id" class="relative pb-2">
                    <!-- 行程卡片 -->
                    <div class="bg-white rounded-2xl p-4 shadow-sm border-l-4 relative group"
                         :class="getCategoryColor(event.category)">
                        
                        <div class="flex justify-between items-start mb-2">
                            <div class="flex items-center gap-2">
                                <span class="bg-gray-100 text-xs px-2 py-0.5 rounded text-gray-500">{{ event.time }}</span>
                                <h3 class="font-bold text-lg text-gray-800">{{ event.name }}</h3>
                            </div>
                            <div class="flex space-x-2">
                                <button @click="openMap(event.name)" class="text-blue-500 bg-blue-50 p-2 rounded-full w-8 h-8 flex items-center justify-center">
                                    <i class="fa-solid fa-location-arrow"></i>
                                </button>
                                <button @click="moveEvent(index, -1)" class="text-gray-400" v-if="index > 0"><i class="fa-solid fa-chevron-up"></i></button>
                                <button @click="moveEvent(index, 1)" class="text-gray-400" v-if="index < currentDayEvents.length - 1"><i class="fa-solid fa-chevron-down"></i></button>
                            </div>
                        </div>

                        <div class="text-sm text-gray-600 space-y-1" @click="editEvent(event)">
                            <p v-if="event.ticket" class="flex items-center"><i class="fa-solid fa-ticket w-5 text-center text-yellow-500 mr-1"></i> {{ event.ticket }}</p>
                            <p v-if="event.note" class="text-gray-400 text-xs line-clamp-2">{{ event.note }}</p>
                        </div>
                        
                        <div class="absolute -right-2 top-10 opacity-20 text-4xl pointer-events-none">
                            <i :class="getCategoryIcon(event.category)"></i>
                        </div>
                    </div>

                    <!-- 行程間交通時間 -->
                    <div v-if="index < currentDayEvents.length - 1" class="flex justify-center items-center py-2 relative z-0">
                         <div class="h-8 w-0.5 bg-gray-300 absolute top-0 bottom-0 left-1/2 -translate-x-1/2 -z-10"></div>
                         <div class="bg-white border border-gray-200 px-3 py-1 rounded-full flex items-center text-xs text-gray-500 shadow-sm cursor-pointer" @click="editTravelTime(event)">
                            <i class="fa-solid fa-person-walking mr-2"></i> <!-- 預設圖示，可改 -->
                            <span>{{ event.nextTravelTime || '15 min' }}</span>
                         </div>
                    </div>
                </div>

                <div v-if="currentDayEvents.length === 0" class="text-center py-10 text-gray-400">
                    <i class="fa-regular fa-calendar-xmark text-4xl mb-3"></i>
                    <p>本日尚無行程</p>
                </div>
            </div>

            <!-- 右下角新增按鈕 -->
            <button @click="openEventModal()" class="fixed bottom-20 right-4 w-14 h-14 bg-blue-600 text-white rounded-full shadow-lg flex items-center justify-center text-2xl active:scale-95 transition-transform z-40">
                <i class="fa-solid fa-plus"></i>
            </button>
        </div>

        <!-- ===== 分頁 2: 資訊 (Info/Dashboard) ===== -->
        <div v-if="currentTab === 'info'" class="space-y-6">
            
            <!-- 儀表板：天氣與匯率 -->
            <div class="grid grid-cols-2 gap-4">
                <!-- 天氣 -->
                <div class="bg-gradient-to-br from-blue-400 to-blue-600 rounded-2xl p-4 text-white shadow-lg relative overflow-hidden">
                    <div class="relative z-10">
                        <p class="text-sm opacity-90">Hokkaido</p>
                        <div class="flex items-center mt-2">
                            <span class="text-3xl font-bold">-2°</span>
                            <i class="fa-solid fa-snowflake text-2xl ml-auto opacity-80"></i>
                        </div>
                        <p class="text-xs mt-1 opacity-80">體感 -5° | 降雪機率 60%</p>
                    </div>
                    <i class="fa-solid fa-wind absolute -bottom-2 -right-2 text-6xl opacity-20"></i>
                </div>
                <!-- 匯率 -->
                <div class="bg-white rounded-2xl p-4 shadow-sm border border-gray-100 flex flex-col justify-between">
                    <p class="text-xs text-gray-500 font-bold">即時匯率 (HKD)</p>
                    <div class="flex items-end gap-1 mt-1">
                        <input type="number" v-model="exchangeInput" class="w-full border-b border-gray-300 focus:outline-none text-xl font-bold text-gray-800 placeholder-gray-300" placeholder="JPY">
                    </div>
                    <div class="text-right text-sm text-green-600 font-bold mt-2">
                        ≈ ${{ (exchangeInput * exchangeRate).toFixed(2) }}
                    </div>
                    <p class="text-[10px] text-gray-400 text-right mt-1">1 JPY = {{ exchangeRate }} HKD</p>
                </div>
            </div>

            <!-- 航班資訊 -->
            <div>
                <div class="flex justify-between items-center mb-2 px-1">
                    <h2 class="font-bold text-gray-700">航班資訊</h2>
                    <button @click="addFlight" class="text-blue-600 text-sm"><i class="fa-solid fa-plus"></i></button>
                </div>
                <div v-for="(flight, idx) in flights" :key="idx" class="bg-white rounded-2xl shadow-sm mb-4 relative overflow-hidden border border-gray-200">
                    <div class="bg-blue-600 h-2 w-full"></div>
                    <div class="p-4">
                        <div class="flex justify-between items-center mb-4">
                            <div class="text-center">
                                <div class="text-2xl font-bold text-gray-800">{{ flight.depCode }}</div>
                                <div class="text-xs text-gray-500">{{ flight.depTime }}</div>
                            </div>
                            <div class="flex-1 flex flex-col items-center px-2">
                                <i class="fa-solid fa-plane text-blue-500"></i>
                                <div class="w-full h-px bg-gray-300 mt-1 relative">
                                    <div class="absolute left-1/2 -top-1 w-2 h-2 bg-gray-300 rounded-full transform -translate-x-1/2"></div>
                                </div>
                                <span class="text-[10px] text-gray-400 mt-1">{{ flight.duration }}</span>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-gray-800">{{ flight.arrCode }}</div>
                                <div class="text-xs text-gray-500">{{ flight.arrTime }}</div>
                            </div>
                        </div>
                        <div class="flex justify-between items-center pt-3 border-t border-dashed border-gray-300">
                            <span class="text-xs font-bold text-gray-600">{{ flight.number }}</span>
                            <span class="text-xs bg-gray-100 px-2 py-1 rounded text-gray-500">{{ flight.type }}</span>
                        </div>
                        <button @click="deleteFlight(idx)" class="absolute top-4 right-2 text-gray-300 hover:text-red-500"><i class="fa-solid fa-times"></i></button>
                    </div>
                </div>
            </div>

            <!-- 住宿資訊 -->
            <div>
                <div class="flex justify-between items-center mb-2 px-1">
                    <h2 class="font-bold text-gray-700">住宿</h2>
                    <button @click="addHotel" class="text-blue-600 text-sm"><i class="fa-solid fa-plus"></i></button>
                </div>
                <div v-for="(hotel, idx) in hotels" :key="idx" class="bg-white rounded-2xl shadow-sm mb-4 overflow-hidden group">
                    <div class="h-32 bg-gray-200 relative">
                        <img v-if="hotel.image" :src="hotel.image" class="w-full h-full object-cover">
                        <div v-else class="w-full h-full flex items-center justify-center text-gray-400"><i class="fa-solid fa-image text-3xl"></i></div>
                        <div class="absolute bottom-2 left-2 bg-black/50 text-white text-xs px-2 py-1 rounded backdrop-blur-sm">
                            <i class="fa-solid fa-clock mr-1"></i> In: {{ hotel.checkIn }} / Out: {{ hotel.checkOut }}
                        </div>
                        <button @click="deleteHotel(idx)" class="absolute top-2 right-2 bg-white/80 w-6 h-6 rounded-full flex items-center justify-center text-red-500 shadow"><i class="fa-solid fa-times text-xs"></i></button>
                    </div>
                    <div class="p-4">
                        <h3 class="font-bold text-gray-800">{{ hotel.name }}</h3>
                        <p class="text-sm text-gray-500 mt-1 truncate"><i class="fa-solid fa-location-dot mr-1 text-red-400"></i> {{ hotel.address }}</p>
                        <div class="flex justify-between items-center mt-3">
                            <a :href="'https://www.google.com/maps/search/?api=1&query=' + hotel.name" target="_blank" class="text-xs bg-blue-50 text-blue-600 px-3 py-1.5 rounded-full font-medium">導航</a>
                            <span class="text-sm font-bold text-gray-700">¥{{ hotel.price }} <span class="text-xs font-normal text-gray-400">/晚</span></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===== 分頁 3: 購物清單 (Shopping) ===== -->
        <div v-if="currentTab === 'shopping'">
            <div class="grid grid-cols-2 gap-3">
                <div v-for="(item, idx) in shoppingList" :key="idx" class="bg-white rounded-xl shadow-sm overflow-hidden relative">
                    <div class="aspect-square bg-gray-100 relative group">
                        <img v-if="item.image" :src="item.image" class="w-full h-full object-cover">
                        <div v-else class="w-full h-full flex items-center justify-center text-gray-300">
                            <i class="fa-solid fa-bag-shopping text-3xl"></i>
                        </div>
                        <button @click="deleteShoppingItem(idx)" class="absolute top-2 right-2 bg-white/90 p-1.5 rounded-full text-red-500 shadow-sm opacity-0 group-hover:opacity-100 transition-opacity">
                            <i class="fa-solid fa-trash text-xs"></i>
                        </button>
                    </div>
                    <div class="p-3">
                        <p class="font-bold text-sm text-gray-800 truncate">{{ item.name }}</p>
                        <p class="text-xs text-gray-400 mt-1">預計: ¥{{ item.price || 0 }}</p>
                    </div>
                </div>
            </div>
             <!-- 右下角新增按鈕 -->
             <button @click="openShoppingModal" class="fixed bottom-20 right-4 w-14 h-14 bg-pink-500 text-white rounded-full shadow-lg flex items-center justify-center text-2xl active:scale-95 transition-transform z-40">
                <i class="fa-solid fa-plus"></i>
            </button>
        </div>

        <!-- ===== 分頁 4: 花費 (Expenses) ===== -->
        <div v-if="currentTab === 'expenses'">
            <!-- 總花費卡片 -->
            <div class="bg-gray-800 text-white rounded-2xl p-5 shadow-lg mb-6">
                <p class="text-sm text-gray-400 mb-1">總花費 (公費 + 個人)</p>
                <h2 class="text-3xl font-bold">¥ {{ totalExpenses.toLocaleString() }}</h2>
                <div class="mt-4 flex gap-2">
                    <div class="flex-1 bg-gray-700 rounded-lg p-2">
                        <p class="text-[10px] text-gray-400">現金</p>
                        <p class="text-sm font-bold">¥ {{ totalByMethod('cash').toLocaleString() }}</p>
                    </div>
                    <div class="flex-1 bg-gray-700 rounded-lg p-2">
                        <p class="text-[10px] text-gray-400">刷卡</p>
                        <p class="text-sm font-bold">¥ {{ totalByMethod('card').toLocaleString() }}</p>
                    </div>
                </div>
            </div>

            <!-- 花費列表 -->
            <div class="bg-white rounded-2xl shadow-sm overflow-hidden">
                <div v-for="(exp, idx) in expenses" :key="idx" class="border-b border-gray-100 last:border-0 p-4 flex justify-between items-center">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full flex items-center justify-center text-white" 
                             :class="getExpenseColor(exp.category)">
                            <i :class="getExpenseIcon(exp.category)"></i>
                        </div>
                        <div>
                            <p class="font-bold text-gray-800 text-sm">{{ exp.name }}</p>
                            <p class="text-xs text-gray-400">{{ exp.date }} | {{ exp.category }}</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="font-bold text-gray-800">-¥{{ Number(exp.amount).toLocaleString() }}</p>
                        <p class="text-[10px] px-1.5 py-0.5 rounded inline-block" 
                           :class="exp.isPublic ? 'bg-purple-100 text-purple-600' : 'bg-gray-100 text-gray-500'">
                           {{ exp.isPublic ? '公費' : '個人' }}
                        </p>
                        <button @click="deleteExpense(idx)" class="ml-2 text-gray-300 hover:text-red-500"><i class="fa-solid fa-trash text-xs"></i></button>
                    </div>
                </div>
            </div>
             <!-- 右下角新增按鈕 -->
             <button @click="openExpenseModal" class="fixed bottom-20 right-4 w-14 h-14 bg-green-500 text-white rounded-full shadow-lg flex items-center justify-center text-2xl active:scale-95 transition-transform z-40">
                <i class="fa-solid fa-plus"></i>
            </button>
        </div>

    </main>

    <!-- ===== Modals (彈出視窗) ===== -->

    <!-- 1. 新增/編輯行程 Modal -->
    <div v-if="showEventModal" class="fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-black/50 backdrop-blur-sm p-4">
        <div class="bg-white w-full max-w-md rounded-2xl p-6 shadow-2xl animate-slide-up">
            <h3 class="text-lg font-bold mb-4">{{ isEditing ? '編輯行程' : '新增行程' }}</h3>
            
            <div class="space-y-3">
                <select v-model="eventForm.category" class="w-full p-3 bg-gray-50 rounded-xl border-none focus:ring-2 focus:ring-blue-500">
                    <option value="spot">景點</option>
                    <option value="food">美食</option>
                    <option value="hotel">住宿</option>
                    <option value="shopping">購物</option>
                    <option value="transport">交通</option>
                </select>
                <input v-model="eventForm.name" placeholder="名稱 (例: 小樽運河)" class="w-full p-3 bg-gray-50 rounded-xl">
                <div class="flex gap-2">
                    <input type="time" v-model="eventForm.time" class="w-1/3 p-3 bg-gray-50 rounded-xl">
                    <input v-model="eventForm.ticket" placeholder="門票/低消" class="flex-1 p-3 bg-gray-50 rounded-xl">
                </div>
                <textarea v-model="eventForm.note" placeholder="備註..." class="w-full p-3 bg-gray-50 rounded-xl h-20"></textarea>
            </div>

            <div class="flex gap-3 mt-6">
                <button v-if="isEditing" @click="confirmDeleteEvent" class="flex-1 bg-red-100 text-red-500 py-3 rounded-xl font-bold">刪除</button>
                <button @click="closeEventModal" class="flex-1 bg-gray-100 text-gray-600 py-3 rounded-xl font-bold">取消</button>
                <button @click="saveEvent" class="flex-1 bg-blue-600 text-white py-3 rounded-xl font-bold">儲存</button>
            </div>
        </div>
    </div>

    <!-- 2. 購物清單 Modal -->
    <div v-if="showShoppingModal" class="fixed inset-0 z-50 flex items-end justify-center bg-black/50 backdrop-blur-sm p-4">
        <div class="bg-white w-full rounded-2xl p-6 shadow-2xl">
            <h3 class="text-lg font-bold mb-4">新增購物清單</h3>
            <input v-model="shoppingForm.name" placeholder="商品名稱" class="w-full p-3 bg-gray-50 rounded-xl mb-3">
            <input type="number" v-model="shoppingForm.price" placeholder="預估價格 (JPY)" class="w-full p-3 bg-gray-50 rounded-xl mb-3">
            <label class="block w-full p-3 bg-gray-50 rounded-xl text-center text-gray-500 mb-4 cursor-pointer">
                <i class="fa-solid fa-camera mr-2"></i> 上傳照片
                <input type="file" accept="image/*" @change="handleImageUpload" class="hidden">
            </label>
            <div v-if="shoppingForm.image" class="mb-4 h-24 rounded-lg overflow-hidden bg-gray-100">
                <img :src="shoppingForm.image" class="h-full w-full object-contain">
            </div>
            <button @click="saveShoppingItem" class="w-full bg-pink-500 text-white py-3 rounded-xl font-bold">加入清單</button>
            <button @click="showShoppingModal = false" class="w-full mt-2 text-gray-400 py-2">取消</button>
        </div>
    </div>

    <!-- 3. 記帳 Modal -->
    <div v-if="showExpenseModal" class="fixed inset-0 z-50 flex items-end justify-center bg-black/50 backdrop-blur-sm p-4">
        <div class="bg-white w-full rounded-2xl p-6 shadow-2xl">
            <h3 class="text-lg font-bold mb-4">記一筆</h3>
            <div class="space-y-3">
                <select v-model="expenseForm.category" class="w-full p-3 bg-gray-50 rounded-xl">
                    <option value="food">飲食</option>
                    <option value="transport">交通</option>
                    <option value="shopping">購物</option>
                    <option value="hotel">住宿</option>
                    <option value="other">其他</option>
                </select>
                <input v-model="expenseForm.name" placeholder="項目名稱" class="w-full p-3 bg-gray-50 rounded-xl">
                <input type="number" v-model="expenseForm.amount" placeholder="金額 (JPY)" class="w-full p-3 bg-gray-50 rounded-xl">
                <div class="flex gap-2">
                    <button @click="expenseForm.method = 'cash'" :class="expenseForm.method === 'cash' ? 'bg-green-100 text-green-600 ring-2 ring-green-500' : 'bg-gray-50'" class="flex-1 p-3 rounded-xl">現金</button>
                    <button @click="expenseForm.method = 'card'" :class="expenseForm.method === 'card' ? 'bg-blue-100 text-blue-600 ring-2 ring-blue-500' : 'bg-gray-50'" class="flex-1 p-3 rounded-xl">信用卡</button>
                </div>
                <div class="flex items-center gap-2 p-3 bg-gray-50 rounded-xl">
                    <input type="checkbox" v-model="expenseForm.isPublic" id="isPublic" class="w-5 h-5">
                    <label for="isPublic" class="text-gray-700">公費支出 (大家平分)</label>
                </div>
            </div>
            <button @click="saveExpense" class="w-full bg-green-600 text-white py-3 rounded-xl font-bold mt-4">儲存</button>
            <button @click="showExpenseModal = false" class="w-full mt-2 text-gray-400 py-2">取消</button>
        </div>
    </div>

</div>

<script>
    const { createApp, ref, computed, reactive, onMounted, watch } = Vue;

    createApp({
        setup() {
            // --- State ---
            const currentTab = ref('itinerary');
            const tabs = [
                { id: 'itinerary', name: '行程表', icon: 'fa-solid fa-map-location-dot' },
                { id: 'info', name: '資訊', icon: 'fa-solid fa-circle-info' },
                { id: 'shopping', name: '購物', icon: 'fa-solid fa-bag-shopping' },
                { id: 'expenses', name: '花費', icon: 'fa-solid fa-wallet' }
            ];

            // 1. 行程資料
            const currentDayIndex = ref(0);
            const itineraryData = ref([
                { date: '2025-01-23', events: [] },
                { date: '2025-01-24', events: [] },
                { date: '2025-01-25', events: [] }
            ]);

            // 2. 資訊資料
            const exchangeRate = ref(0.052); // JPY to HKD mock
            const exchangeInput = ref(1000);
            const flights = ref([
                { type: '去程', depCode: 'HKG', arrCode: 'CTS', depTime: '09:00', arrTime: '14:30', duration: '5h 30m', number: 'CX580' }
            ]);
            const hotels = ref([
                { name: '札幌格蘭大飯店', address: '札幌市中央區北1條西4丁目', price: 15000, checkIn: '15:00', checkOut: '11:00' }
            ]);

            // 3. 購物 & 花費
            const shoppingList = ref([]);
            const expenses = ref([]);

            // --- Modals State ---
            const showEventModal = ref(false);
            const showShoppingModal = ref(false);
            const showExpenseModal = ref(false);
            const isEditing = ref(false);
            const currentEditId = ref(null);

            // Forms
            const eventForm = reactive({ name: '', time: '10:00', category: 'spot', ticket: '', note: '', nextTravelTime: '15 min' });
            const shoppingForm = reactive({ name: '', price: '', image: null });
            const expenseForm = reactive({ category: 'food', name: '', amount: '', method: 'cash', isPublic: false });

            // --- Methods ---

            // 初始化 & LocalStorage
            onMounted(() => {
                const saved = localStorage.getItem('hokkaidoApp_v1');
                if (saved) {
                    const data = JSON.parse(saved);
                    itineraryData.value = data.itineraryData || itineraryData.value;
                    shoppingList.value = data.shoppingList || [];
                    expenses.value = data.expenses || [];
                    flights.value = data.flights || flights.value;
                    hotels.value = data.hotels || hotels.value;
                }
                // 模擬抓天氣/匯率 (這裡可以換成 fetch API)
                exchangeRate.value = 0.052; 
            });

            watch([itineraryData, shoppingList, expenses, flights, hotels], () => {
                const data = {
                    itineraryData: itineraryData.value,
                    shoppingList: shoppingList.value,
                    expenses: expenses.value,
                    flights: flights.value,
                    hotels: hotels.value
                };
                localStorage.setItem('hokkaidoApp_v1', JSON.stringify(data));
            }, { deep: true });

            // Helpers
            const getDayOfWeek = (dateStr) => {
                const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                return days[new Date(dateStr).getDay()];
            };
            const getDayDate = (dateStr) => {
                const d = new Date(dateStr);
                return `${d.getDate()}/${d.getMonth() + 1}`;
            };
            const openMap = (query) => {
                window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(query + ' 北海道')}`, '_blank');
            };

            // Itinerary Logic
            const currentDayEvents = computed(() => itineraryData.value[currentDayIndex.value].events);
            
            const addDay = () => {
                const lastDate = new Date(itineraryData.value[itineraryData.value.length - 1].date);
                lastDate.setDate(lastDate.getDate() + 1);
                itineraryData.value.push({
                    date: lastDate.toISOString().split('T')[0],
                    events: []
                });
            };

            const openEventModal = () => {
                isEditing.value = false;
                Object.assign(eventForm, { name: '', time: '10:00', category: 'spot', ticket: '', note: '', nextTravelTime: '15 min' });
                showEventModal.value = true;
            };

            const editEvent = (event) => {
                isEditing.value = true;
                currentEditId.value = event.id;
                Object.assign(eventForm, event);
                showEventModal.value = true;
            };

            const saveEvent = () => {
                if (!eventForm.name) return;
                const events = itineraryData.value[currentDayIndex.value].events;
                
                if (isEditing.value) {
                    const idx = events.findIndex(e => e.id === currentEditId.value);
                    if (idx !== -1) events[idx] = { ...events[idx], ...eventForm };
                } else {
                    events.push({ ...eventForm, id: Date.now() });
                }
                // 簡單排序：按時間
                events.sort((a, b) => a.time.localeCompare(b.time));
                showEventModal.value = false;
            };

            const confirmDeleteEvent = () => {
                if(confirm('確定要刪除此行程嗎？')) {
                    const events = itineraryData.value[currentDayIndex.value].events;
                    const idx = events.findIndex(e => e.id === currentEditId.value);
                    events.splice(idx, 1);
                    showEventModal.value = false;
                }
            };

            const moveEvent = (index, direction) => {
                const events = itineraryData.value[currentDayIndex.value].events;
                const temp = events[index];
                events[index] = events[index + direction];
                events[index + direction] = temp;
            };
            
            // UI Helpers
            const getCategoryColor = (cat) => {
                const map = { spot: 'border-green-500', food: 'border-orange-500', hotel: 'border-purple-500', shopping: 'border-pink-500', transport: 'border-blue-500' };
                return map[cat] || 'border-gray-500';
            };
            const getCategoryIcon = (cat) => {
                const map = { spot: 'fa-camera', food: 'fa-utensils', hotel: 'fa-bed', shopping: 'fa-bag-shopping', transport: 'fa-train-subway' };
                return 'fa-solid ' + (map[cat] || 'fa-circle');
            };

            // Info Logic
            const addFlight = () => {
                // 簡化：直接新增一個範本供編輯
                flights.value.push({ type: '回程', depCode: 'CTS', arrCode: 'HKG', depTime: '16:00', arrTime: '20:30', duration: '5h 30m', number: 'CX581' });
            };
            const deleteFlight = (idx) => flights.value.splice(idx, 1);
            
            const addHotel = () => {
                hotels.value.push({ name: '新飯店', address: '地址...', price: 0, checkIn: '15:00', checkOut: '11:00' });
            };
            const deleteHotel = (idx) => hotels.value.splice(idx, 1);

            // Shopping Logic
            const openShoppingModal = () => {
                Object.assign(shoppingForm, { name: '', price: '', image: null });
                showShoppingModal.value = true;
            };
            const handleImageUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => shoppingForm.image = e.target.result;
                    reader.readAsDataURL(file);
                }
            };
            const saveShoppingItem = () => {
                if(!shoppingForm.name) return;
                shoppingList.value.push({ ...shoppingForm });
                showShoppingModal.value = false;
            };
            const deleteShoppingItem = (idx) => shoppingList.value.splice(idx, 1);

            // Expense Logic
            const openExpenseModal = () => {
                Object.assign(expenseForm, { category: 'food', name: '', amount: '', method: 'cash', isPublic: false });
                showExpenseModal.value = true;
            };
            const saveExpense = () => {
                if(!expenseForm.amount) return;
                const d = new Date();
                expenses.value.push({
                    ...expenseForm,
                    date: `${d.getMonth()+1}/${d.getDate()}`,
                    id: Date.now()
                });
                showExpenseModal.value = false;
            };
            const deleteExpense = (idx) => expenses.value.splice(idx, 1);
            
            const totalExpenses = computed(() => expenses.value.reduce((sum, item) => sum + Number(item.amount), 0));
            const totalByMethod = (method) => expenses.value.filter(e => e.method === method).reduce((sum, item) => sum + Number(item.amount), 0);
            
            const getExpenseIcon = (cat) => {
                 const map = { food: 'fa-utensils', transport: 'fa-bus', shopping: 'fa-bag-shopping', hotel: 'fa-bed', other: 'fa-coins' };
                 return 'fa-solid ' + (map[cat] || 'fa-circle');
            };
            const getExpenseColor = (cat) => {
                 const map = { food: 'bg-orange-400', transport: 'bg-blue-400', shopping: 'bg-pink-400', hotel: 'bg-purple-400', other: 'bg-gray-400' };
                 return map[cat];
            };

            const calcTravelTime = (prev, current) => {
                // 這裡沒有 API，所以顯示假資料或使用者手動輸入的
                return "15 min (預估)";
            };
            const editTravelTime = (event) => {
                const newTime = prompt("輸入交通時間", event.nextTravelTime || "15 min");
                if(newTime) event.nextTravelTime = newTime;
            };

            return {
                currentTab, tabs,
                itineraryData, currentDayIndex, currentDayEvents, addDay, getDayOfWeek, getDayDate,
                eventForm, showEventModal, isEditing, openEventModal, editEvent, saveEvent, confirmDeleteEvent, moveEvent,
                getCategoryColor, getCategoryIcon, openMap,
                // Info
                exchangeRate, exchangeInput, flights, hotels, addFlight, deleteFlight, addHotel, deleteHotel,
                // Shopping
                shoppingList, showShoppingModal, shoppingForm, openShoppingModal, handleImageUpload, saveShoppingItem, deleteShoppingItem,
                // Expense
                expenses, showExpenseModal, expenseForm, openExpenseModal, saveExpense, deleteExpense, 
                totalExpenses, totalByMethod, getExpenseIcon, getExpenseColor,
                calcTravelTime, editTravelTime
            };
        }
    }).mount('#app');
</script>
</body>
</html>
```